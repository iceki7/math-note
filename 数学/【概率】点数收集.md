收集1个骰子上的所有点数需要几次

---

**直接计数**

扔n次，考虑扔出的顺序，所有可能情况$6^n种$，把其中有i种花色的排列的个数记为$S_n^i$。不考虑扔出的顺序只考虑花色的种类，则是$2^6-1$种情况。而如果考虑各种花色的比例呢？情况数又是怎样？这个似乎有点复杂，它是一个整数的所有能够分解的方案数，姑且记为$w(n)$，之后再讨论。












思路1.直接计算$S$

那么花色为5种的情况到底是多少个？
我们试试看能不能构造出来。（但是，如果能直接数出来有多少种，其实也就能数出来花色为6的情况到底有多少种，问题也就解决了。所以这里会有一个涉及投掷次数、花色个数的递推关系之后再考虑。
\\
）
首先，还是先选出5种花色，$C_6^5$
然后，对于任意一个仅由这5个花色组成的排列，考虑从左往右每个花色首次出现的顺序，这就有$A_5^5$种可能。
确定了每个花色出现的顺序后，接下来就是考虑如何把n-5个元素插入到这个5元素的排列中并且不破坏花色从左到右的出现顺序。假设这5个元素是 1 2 3 4 5，
那么第一步只需要在1，2之间插入1。（1的左边不插入1了，否则会导致重复计数）
第二步只需要在2，3之间插入1，2。这里对于插入的元素的顺序没有要求。
类推。

第一步中，也可以不插。$所以这一步有2^{n-5}$种选择，但是这里如果插入的元素过多，后续插入就没有那么多机会了，无论如何，所有间隙里插入的元素个数的和只有那么多个，于是注意到这和前面说的那个函数$w$有密切的关系，也是要用一个整数的分拆的种类数来描述。也即，给定一个整数以及它要分拆成几个部分，讨论它在考虑顺序和无顺序的情况下能拆成几项？但是光拆还不够，它只是指出了1，2，3，4，5中间分别要插入几个元素，
但是还得讨论插入元素的顺序...


太复杂了。直接计算S不太可行。

---

思路2：

研究一下花色<=5种的情况？也即计算$\sum_i S_n^i=T_n^i$

有一个直觉上的近似：$T_n^5=C_6^55^n?$。但是这个近似肯定重复计数了，所以它不是准确值，姑且把它写成$R$吧，表示T的近似

比如，刚好用到4种花色的排列被重复计数了。重复了几次？假设这四种花色是1234 那么在选择花色时它在花色为12345 和23456时都被计数了，并且各自都被计数了1次。

同理，刚好用到3种花色的排列被重复计数了$C_{6-3}^{5-3}=3$次，推而广之，写作$C_{N-j}^{i-j}$,N是骰子点数的个数,j表示刚好用到的花色数)

而在$R_n^{i-1}$中呢？刚好用到j次花色的排列被重复计数了：$C_{N-j}^{i-1-j}$



然后就是考虑怎么用$R_n^{N-1},...R_n^1$进行消去了。
这些元素里，对刚好用到j次花色的排列的重复计数次数分别是(列成表格,i行j列)：
$$
\begin{matrix}
  1 & C_2^1 & C_3^2& C_4^3& C_5^4 \\
  0 & 1     & C_3^1& C_4^2& C_5^3 \\
  0 & 0     & 1    & C_4^1& C_5^2 \\

\end{matrix}

$$
类似这样，


而根据以下熟悉的关系:

$$
(1-1)^n=C_n^1(-1)^1+C_n^2(-1)^{2}+...+C_n^{n-1}(-1)^{n-1}+1+(-1)^n
$$
会发现只要逐行交错相减相加，就能得到
$T_n^i$

所以$T_n^5=R_n^5-R_n^4+R_n^3-...+R_n^1$

那么概率就是：
$$
p=1-\frac{T_n^5}{6^n}
$$

---end---

主要任务完成了。下面考虑把这个公式做一系列一般化的处理。

首先是给定N后，

$$
T_n^i=\sum_{j=1}^{i} C_N^jj^n(-1)^{f(j)},f用来表示奇偶性
$$

,注意这个式子成立要求i<N,因为i=N时，并没有出现重复计数的情况，所以不能用$R$交错相减去求，而是$T_n^N=R_n^N$


$$
然后求S。
i<N时，
\\S_n^i=T_n^i-T_n^{i-1}=R_n^i+2(-R_n^{i-1}+R_n^{i-2}-R_n^{i-3}...)
\\

$$
此外，也注意到$T_n^n（此时要求n\leq N)$还有另外一个表达式：

$T_5^5=6^5=C_6^5 5^5-C_6^4 4^5+...+C_6^1 1^5 *$
所以

$N^n=\sum_{j=1}^n C_N^jj^n(-1)^{f(j)},n\leq N$

*式能化成二项式或母函数的形式吗？这里的形式很怪，j居然没有出现在指数上而是底数，这就仿佛是在说一个数的2次方是2，3次方是3，
$$
(-1+x^{1/x})^n
$$

为了把它写成母函数，构造一个交换底数和指数的函数：
$z(x)=(log_Cx)^C$,它要是有乘性就好了：
$$
z(x)z(y)=
$$

$$
(z(x)-1)^N
$$


----------true end----------------


---------??
假设5种花色已经给定了，那么没有用到另外1种花色的排列有$5^n$种，所以，此时总共有$C_6^5 5^n$种情况是有起码一种花色没有被用到的情况。

但是，一种排列它可能既没有用到花色1，也没有用到花色2，所以，上面$C_6^5 5^n$中包含了某些元素被重复计数了


这也好办，既没有用到花色1和2的元素的个数是$4^n$种
所以，有2种花色没有用到的全部排列个数是$C_6^44^n$

同理，它也有元素被重复计数了，所以它实际上描述的是“有至少2种花色没有被用到”的全部排列个数。

这个过程可以递归。

---------end ??




所以$T_n^5$


$$

C_6^55^n-C_6^44^n+C_6^33^n-...+C_6^11^n=k(n,5,6)
$$
（PS顺带考察一下它能不能化成二项式展开？似乎不行）

所以花色刚好为6种的情况是$6^n-上面那一串$

同时，我们也断言$k(n,i,6)-k(n,i-1,6)$

---

再试试能不能用前面提到的递推关系来做，
投n次有i种花色的【排列】数记为$S_n^i$，$S_n^i$逐项求和记为$T_n^i$，

那么$S_n^1+S_n^2+...+S_n^6=6^n$

n和n+1之间有没有递推关系呢？比如，如果在一个序列的最后一项加入一个新花色的元素，那么......
忽然灵光一现，意识到这里就和解背包问题是一样的，
$$
S_n^i=S_{n-1}^i*i+S_{n-1}^{i-1}*{(6-(i-1))}
$$
用这个递推关系可以求了，但只是递推。不是通项。

一个思路是暴力计算，然后猜测通项，再用数学归纳法。

ni1 2	  3	  4	  5
1	6
2	6 30
3 6 90  120       
4	6 210 720
5	6 450 3000










---
一开始没想到上述公式。绕了一个大弯：


k个点数,假设恰好是在第n次时集齐的概率是:

$$
p_k(n)=\frac{kx(n-1,k-1)}{k^n}
$$
x表示一个包含了k-1种点数的长为n-1的串的个数,但是想不出来是多少.



再考虑扔出n次之后,集齐了的概率是:

$$
\sum_{i=k}^n p_k(i)=q_k(n)
\\=\frac{x'}{k^n}
$$

x'是一个包含了k种点数的长为n的串的个数(注意，k种指的是总共只有k种点数，凑齐一个n长的串，而不是指从若干花色里选k种然后再凑齐这么一个串,那样的话有3个自由度了)

所以$x'=x(n,k)$

注意到，如果选k个时集齐了花色，要么就是在第k个时集齐的，要么就是在第k-1个时就已经集齐了，形式化地描述就是：
$$
x(n,k)=x(n-1,k)k+x(n-1,k-1)k
$$

先写一些观察一下:

$x(1,i)=1,i\in[1,n]\\
x(2,i)=1,2,\\
x(3,i)=1,6,6,\\
x(4,i)=1,14,36,24,\\
x(5,i)=1,30,150,240,...\\
x(6,i)=1,62,540,1560...
$



而$x(n,2)=2^n-2,x(n,1)=1$


$$
x(n,3)=3x(n-1,3)+2^{n-1}\cdot3-6

\\设x(n,3)+2^na+C=3(x(n-1,3)+2^{n-1}a+C)
\\\Rightarrow a=3,C=-3
\\所以x(n,3)+2^n\cdot 3-3是等比数列，首项27，
\\x(n,3)=3^{n}+3-3\cdot 2^n
$$

之后怎么办呢？思路1是猜测x(n,k)的表达式是形如
$$
Ck^n+C'(k-1)^n+C''的形式
$$
然后用归纳法验证。有一定运气成分。这个条件可能不够强。


思路2是回到x(n,3)的语义上来。它的表达式看起来并不复杂，是不是提示了一种之前没想到的计数的方式？

还是很难看出来

于是再算一组：
$$
x(n,4)=4^{n}-4+6\cdot 2^n-4\cdot 3^n
$$

仍然无果。那就上函数空间的线性变换吧。
基就是$k^n$，把x写为系数向量，比如
$x(n,4)=[-4,6,-4,1]^T$
那么递推关系式就是：
$$
x_k=k\begin{bmatrix}
  1  & 0 & 0 & 0\\
  0  & 1/2 & 0 & 0\\
    0  & 0 & 1/3 & 0\\
      0  & 0 & 0 & 1/4\\
\end{bmatrix}(x_k+x_{k-1})=K(x_k+x_{k-1})
\\


(I-K)x_k=Kx_{k-1}
\\=x_{k-1}-Kx_{k-2}=x_{k-1}-x_{k-2}+Kx_{k-3}
\\=x_{k-1}-x_{k-2}+x_{k-3}-x_{k-4}+...+(-)Kx_1
\\\\
x_1=[1]\\
x_2=[-2,1]\\
x_3=[3,-3,1]\\
x_4=[-4,6,-4,1]\\
x_5=[5,-10,10,-5,1]\\
x_6=[-6,15,-20,15,-6,1]\\
(I-K)x_3=x_2-Kx_1
\\
观察系数，如果在x的第一项前面再扩展一项1，\\则猜想方程的解就是(*表示扩展出来的区域):
\\

x_n=\begin{bmatrix}
 1* & -1*  & 0* & 0* & 0*\\
 0*& 1  & -1 & 0 & 0\\
 0*&   0  & 1 & -1 & 0\\
 0*&     0  & 0 & 1 & -1\\
\end{bmatrix}x_{n-1}


$$


$$
q_6(n)=\frac{-6+15\cdot 2^n-20\cdot 3^n+15\cdot 4^n-6\cdot 5^n+6^n}{6^n}
$$
