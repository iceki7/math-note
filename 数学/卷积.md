**概率和**

两个骰子的和分布。表格。

$$
P_{X+X}(s)=\sum_{i}P_X(i)P_X(s-i)
\\ i\in[x_i,x_m],s\in[2x_i,2x_m]，且令P_X(x_i-1)=0
$$

前提：X的取值是连续整数

---


**推广**

两个随机变量不一定要相同 $X\neq Y$。

X的取值可以是不连续的整数。
只要为定义域外的值全赋0即可。

s和i取值范围推广为任意整数。


$$
P_{X+Y}(s)=[P_X * P_Y](s)
$$

*: convolution operator，作用于函数

---


**滑动窗口**

把卷积的表达式放在坐标系中思考几何意义，容易联想到滑动窗口。s控制窗口位置。i控制扫描过程。

---

**运算律**

交换律

分配律
与乘法的分配律。

*结合律*

证明的思路：
$$
\sum_s(\sum_i (P_X(i)P_Y(s-i)))P_Z(t-s)
\\=\sum_{a+b+c=t} P_X(a)P_Y(b)P_Z(c)
$$

---



例：如果b是一个和为1的均值数组，就是对a求平均值。

CCONV:根据要求的结果调整核。

---

**多项式乘法**

如 $305×1003=(3\times 10^2+5\times 10^0)(1\times 10^3+3\times 10^1)$

因为系数两两相乘后，要把指数相同的项再相加。所以指数到系数的映射和$P_X(s)$类似。


---

**采样**

直接做卷积，复杂度O(n2)


但是，给定n个点，可确定唯一的一个n-1阶多项式。（当然，这n个点有一些限制条件，可以通过研究线性方程组来确定）

所以，要计算卷积时，可以选择先采样。计算逐点相乘后的值，然后还原出多项式的乘积系数。

通过采样的方式并不能直接降低复杂度。
为此，还需要引入复数才行，即构成了FFT。



这个过程如果使用单位圆上的复数，就是FFT算法，复杂度O(nlogn)

---
FFT
例如，f、g都是三次多项式，采样四个点：
$$
f(a)=c_3a^3+c_2a^2+c_1a^1+c_3a \\
f(a^2)=c_3a^3+c_2a^2+c_1a^1+c_3a \\
f(a^3)=c_3a^3+c_2a^2+c_1a^1+c_3a
$$

乘法即是做卷积，例如12×34，写成(1,2),(3,4)的形式，分别列出竖式和矩阵，即可发现的确如此。它做卷积以后是(1,2)*(3,4)=(3,10,8)，进位后即为408。

复杂度O(n2),n是数字长度。

现在，假设对两个超大数f,g（分别是n,m位长）做卷积。

也就是两个多项式（n-1，m-1次）相乘，求它们的系数。

---

思路：
f，g分别都采样n+m个点

（结果多项式的最高次数为n+m-2），将对应的点相乘
$$
f(a)g(a),f(a^2)g(a^2),...
$$
系数可以被还原出来。
只要求解线性方程组
$$f(a),f(a^2),f(1),\mathbb{C}\rightarrow \mathbb{C}$$
即可。
用矩阵表示：

$$
WC=Y
$$
C是多项式系数，W是采样点，Y是在采样处的函数值。
还原多项式时，$C=YW^{-1}$

W的逆阵非常好求。

---
实现

采样时，我们希望能很快计算出样本点的值。

如果是选取x=1,x=2这样的点，仍然需要进行复杂的计算，不能降低复杂度
但是偶/奇函数当中，采样对称点可以少算一半的值。
所以实际上只需要采样一半的点。


任给一个多项式，可以把它分解：
$$
P(x)=E(x^2)+xD(x^2)=e(x)+xd(x)
$$
D、E是分别把P中的奇数项、偶数项分开。
例如，P=(7542),  
$$
E=((x^2)^2+(x^2)^1), D=((x^2)^2+(x^2)^3)
$$
并且D、E的次数只有n/2(下取整)

例如，x3+x2-x-1
取x=1，如果想知道-1的值，代入P(-x)=E(x2)-xD(x2)
这意味着只需要计算出E(1^2)、D(1^2)的值，可以避免计算多项式,就可以得到2个采样。

但是，即便如此，还是要计算出
$\frac{n}{2}$个的样本的E、D值。

更理想的情况是，我们希望即使通过更少的E，得到尽可能多的不同的样本点。由于E可以像P一样再被分解一次，
变成$E=E'+xD'$，

所以我们希望能够有一个同时计算$E(x_1^2),E(-x_1^2)$的需求。

而后面那项来自于一个新的样本点$x_2$，$-x_1^2=x_2^2$

例如，对一个三次多项式
$$
P=5x^3+7x^2-3x-2=7x^2-2+x(5x^2-3)
$$
$x_1=1$,$x_2=i$，这样我们等于是在$\pm 1,\pm i$这四个点上采了样。

最后计算各个参数的顺序就是：
$$
E'_E(1),D'_E(1)→E(1),E(-1)\\
E(1),D(1)→P(1),P(-1)\\
E(-1),D(-1)→P(i)P(-i)\\
$$
$$
E'_E(a)=-2\\
D'_E(a)=7\\
E'_D(a)=-3\\
D'_D(a)=5\\
-2,7→5,-9\\
5,2→7,3\\
-9,-8→-9-8i,-9+8i\\
$$
如果采样n个点(n=2^k)，那么计算E'时每个子树返回一个值；计算E时每个子树返回2个值，计算P时返回4个值。
所以复杂度为$O(n\log n)$

再比如：
$$
E''(1)→E'(-1),E'(1) \\
E'(-1)→E(-i)E(i), E'(1)→E(1),E(-1)\\
最后对应到的单位根是 \omega^{3,7,1,5,4,0,2,6}
$$

所以使用单位根
$$
\omega=e^{2\pi i/(2^k)}
$$
，
此时有一个良好的性质：
$$
-\omega^{j}=\omega^{j+n/2}
$$

$$
P(-\omega^j)=E(\omega^{2j})-\omega^jD(\omega^{2j})=P(\omega^{j+n/2})
$$

---


假设n=3,m=4
$$
a=e^{2\pi i /7}\\
$$

$$
f(a)=0(a^6+a^5+a^4+a^3)+c_2 a^2+c_1 a+c_0 \\
$$
为简便，只写出指数。$[6,5,4,3,2,1,0]$
$$
f(a^2)=[5,3,1,6,4,2,0] \\
...\\
f(1)=\sum c_i
$$
这里由于7是质数，所以矩阵M中任意一行，任意一列都不重复。
将这些复数都逐点相乘$f(x)g(x)=h(x)$，计算$f(a^i)g(a^i)$，得到$h(1),h(a),...h(a^6)$
然后还原系数。


我们想要得到对系数c做卷积的结果。
即我们要求$f(x)g(x)，或f*g$



对于多项式的卷积，可以将采样的点相乘：
$$
f(a_1)g(a_1),f(a_2)g(a_2),..\\
$$
这样，可以得到多项式h上最多n×m个点的采样，但只需要n+m+2个点即可恢复h。

$$
g(b)+g(b^2)+g(b^3)+g(1)=

$$